


tcl;

proc readFile {propEntry} {
    set configPath [file join "/apps/Aniket/UserStory_AATL-30539/ReferenceDocMigration/Config" "LegacyDocConfig.txt"]

    if {![file exists $configPath]} {
        error "Config file not found: $configPath"
    }

    set fh [open $configPath r]
    set lines [split [read $fh] "\n"]
    close $fh

    set valuesList {}

    foreach line $lines {
        # Skip empty lines or comment lines starting with #
        if {[string trim $line] eq "" || [string match "#*" $line]} {
            continue
        }

        # Match the desired property and extract values
        if {[regexp "^$propEntry=(.*)" $line -> values]} {
            foreach val [split $values ","] {
                lappend valuesList [string trim $val]
            }
            break
        }
    }

    return $valuesList
}

proc extractReferenceDocs {typeList input_file output_dir success_log error_log} {
	
	set in    [open $input_file r]
    set lines [split [read $in] "\n"]
    close $in
	
	set header [lindex $lines 0]
	
	array set typeData {}
	
	
	
	
	
	
}


proc setTriggerOff {} {
	set errorCreate [ catch {mql trigg off} ResultCreate ]
	puts $ResultCreate
}

proc setTriggerOn {} {
	set errorCreate [ catch {mql trigg on} ResultCreate ]
	puts $ResultCreate
}

proc setHistoryOff {} {
	set errorCreate [ catch {mql history off} ResultCreate ]
	puts $ResultCreate
}

proc setHistoryOn {} {
	set errorCreate [ catch {mql history on} ResultCreate ]
	puts $ResultCreate
}

eval {
	set base_dir [pwd]
	set output_dir  "$base_dir/../Output"
    set input_dir "$base_dir/../Input/Spec_TM_Report.xls"
	
	
	set timeStr [clock format [clock seconds] -format "%Y%m%d_%H%M%S"]
	
	if {![file exists $input_dir]} {
		puts "Input directory missing"
		exit 1
	}
	
	
	
	if {![file exists $output_dir]} {
        file mkdir $output_dir
    }
	
	set archive_dir "$output_dir/Archive/"
	if {![file exists $archive_dir]} {
		file mkdir $archive_dir
	}
	
	set oldOutput_dir "$archive_dir/$timeStr/"
	if {![file exists $oldOutput_dir]} {
		file mkdir $oldOutput_dir
	}
	
	foreach old_output [glob -nocomplain -directory $output_dir *.txt] {
		file rename -force $old_output "$oldOutput_dir/"
	}
	
	set success_log [open "$output_dir/extraction_success_log.txt" w]
	set error_log   [open "$output_dir/extraction_error_log.txt" w]
	
	set startTime "========= Extraction started at [clock format [clock seconds] -format {%b %d, %Y %I:%M:%S %p}] ========="
	puts $startTime
	puts $success_log "$startTime"
	
	set typeList [readFile "TYPES"]
    if {[llength $typeList] == 0} {
        puts "Error: TYPES not defined in LegacyDocConfig.txt"
        exit 1
    }
	
	puts $typeList
	
	extractReferenceDocs $typeList $input_dir $output_dir $success_log $error_log
	
	set triggOff [setTriggerOff]
	set historyOff [setHistoryOff]
	
	close $error_log

	set triggOn [setTriggerOn]
	set historyOn [setHistoryOn]

	set endTime "========= Extraction completed at [clock format [clock seconds] -format {%b %d, %Y %I:%M:%S %p}] ========="
	puts $endTime
	puts $success_log "$endTime"
	close $success_log
	
	
}
