<%@ page import="matrix.db.Context" %>
<%@ page import="com.matrixone.apps.domain.util.*" %>
<%@ page import="matrix.util.*" %>

<html>
<body>

<h2>Standalone JSP with ENOVIA Login</h2>

<%
    // -------------------------------
    // Credentials (fill with your data)
    // -------------------------------
    String PASSPORTURL = "https://your-passport-url";
    String SERVICEURL  = "http://your-enovia-server:port/enovia";
    String USER        = "creator";
    String PASSWORD    = "password";
    String ROLE        = "User";

    // -------------------------------
    // ENOVIA login using your method
    // -------------------------------
    Context context = null;

    try {
        System.setProperty("bypass.cert", "true");

        // EXACTLY the same as your Util.connect() usage
        context = Util.connect(
                    SERVICEURL,
                    PASSPORTURL,
                    USER,
                    PASSWORD,
                    ROLE,
                    "",
                    true
                 );

        if (context == null || !context.isConnected()) {
            out.println("<p style='color:red;'>❌ ENOVIA Login Failed</p>");
        } else {
            out.println("<p style='color:green;'>✔ ENOVIA Login Successful</p>");

            // ------------------------------
            // Put your custom logic here
            // Example: print logged-in user
            // ------------------------------
            out.println("<p>Logged in as: <b>" + context.getUser() + "</b></p>");
            out.println("<p>Role: <b>" + ROLE + "</b></p>");
            out.println("<p>Service URL: <b>" + SERVICEURL + "</b></p>");

            // You can also do small MQL if needed:
            String name = MqlUtil.mqlCommand(context, "print person $1 select name dump", USER);
            out.println("<p>Full Name from ENOVIA: <b>" + name + "</b></p>");
        }

    } catch (Exception e) {
        out.println("<p style='color:red;'>Exception occurred</p>");
        e.printStackTrace(out);
    } finally {
        try {
            if (context != null && context.isConnected()) {
                context.close();
            }
        } catch (Exception ex) {
            ex.printStackTrace(out);
        }
    }
%>

</body>
</html>
