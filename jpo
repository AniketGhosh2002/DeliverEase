#!/usr/bin/tclsh

# -------------------------------
# CONFIG SECTION
# -------------------------------

# Input report file (tab-separated)
set inputFile "report.xls"

# List of Types to extract
set typesList {Document Spec Drawing CADModel Part}

# Output directory
set outDir "Output"
file mkdir $outDir

# Column order you want in output:
# Name State Title Type Rev
# Mapping input col â†’ output col
# Input index: 0:Type 1:Name 2:Rev 3:Title 4:State
array set colIndex {
    Name 1
    State 4
    Title 3
    Type 0
    Rev 2
}

# -------------------------------
# SCRIPT START
# -------------------------------

# Read input file
set fh [open $inputFile r]

# Skip header
gets $fh headerLine

# Open a file handle map for each Type
array set outFH {}
foreach t $typesList {
    set outFH($t) [open "$outDir/${t}_output.txt" w]
}

# Process each line
while {[gets $fh line] >= 0} {

    # Split by tab
    set cols [split $line "\t"]

    # Skip if not enough columns
    if {[llength $cols] < 5} continue

    # Take input Type (col 0)
    set inType [lindex $cols 0]

    # If Type matches any from the list
    if {[lsearch -exact $typesList $inType] != -1} {

        # Reorder to desired columns
        set outputRow ""
        foreach k {Name State Title Type Rev} {
            append outputRow [lindex $cols $colIndex($k)] "\t"
        }

        # Remove last tab
        set outputRow [string trimright $outputRow "\t"]

        # Write to that Type's file
        puts $outFH($inType) $outputRow
    }
}

close $fh

# Close all output files
foreach t $typesList {
    close $outFH($t)
}

puts "Processing complete. Check '$outDir/' folder."
